{% extends 'base.html' %}
{% load staticfiles %}

{% block title %}
    文章详情
{% endblock %}

{% block content %}

<div class="container">
    <div class="row">
        <div class="col-9">
            <h1 class="mt-4 mb-4">{{ article.title }}</h1>
            <div class="alert alert-success">
                <div>
                    作者：{{ article.author }}
                    {#  <a href="#" onclick="confirm_delete()">删除文章</a>#}

                    {% if article.author == user %}
                        <a href="#" onclick="confirm_safe_delete()">删除文章</a>
                        <a href="{% url 'article:article_update' article.id %}">编辑文章</a>

                    {% endif %}

                    <!-- 新增一个隐藏的表单 -->
                    <form
                            action="{% url 'article:article_delete' article.id %}"
                            id="safe_delete"
                            method="post"
                            style="display: none"
                    >
                        {% csrf_token %}
                        <button type="submit">发送</button>
                    </form>
                </div>

                <div>
                    浏览：{{ article.total_views }}
                </div>
            </div>
            <p>{{ article.content | safe }}</p>
        </div>

        <div class="col-3 mt-3">
            <h4 style="margin-top: 1em"><strong>目录</strong></h4>
            <hr>
            <div>
                {{ toc | safe }}
            </div>
        </div>
    </div>
</div>

<script>

    {# 这种方式不能防止csrf攻击 #}
    function confirm_delete() {
        layer.open({
            title:"确认删除",
            content:"确认删除这篇文章吗?",
            yes:function (index, layero) {
                location.href='{% url "article:article_delete" article.id %}'
            },
        })
    }

    function confirm_safe_delete() {
        layer.open({
            title:"确认删除",
            content:"确认删除这篇文章吗?",
            yes:function (index, layero) {
                $('form#safe_delete button').click();
                layer.close(index);
            },
        })
    }

</script>


{% endblock content%}